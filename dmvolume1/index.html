<!DOCTYPE HTML>
<html class="js" lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Minor Arth | Depeche Mode mashups volume 1</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta property="og:url"   content="https://araynaud.github.io/albums/dmvolume1/"/>
	<meta property="og:image" content="https://araynaud.github.io/albums/dmvolume1/MinorArth-DMMashups-volume1.jpg">
	<meta property="og:image:width" content="720">
	<meta property="og:image:height" content="720">
	<meta property="og:image:type" content="image/jpeg">
	<style>
	@media screen {
		body{
			background-image: linear-gradient(-90deg, #100010, #400040);
			/* background-color: #100010; */
			color: white;
		}

		a, .number { color: #e7d1ac; }
		p.sources { color: #DDD; }

		div.playlist-template {
			width: 480px;
			background-color: #001520;
		}

		div.active {
			background-color: #004560;
		}
	}

	a, .bold { font-weight: bold; cursor: pointer; }

	body {
		font-family:  Helvetica, sans-serif, 'Tw Cen MT', 'HP Simplified', Arial;
		text-align: center;
	}

	.align-left  { text-align: left; }
	.align-right { text-align: right; }

	img.player-image[src] { max-width: 720px; border: solid 8px white;  }
	div.toolbar audio {	width: 600px; height: 24px; }
	div.repeater { max-width: 1400px; }

	@media only screen and (max-width: 2140px)
	{
		img.player-image[src] { max-width: 600px;   border: solid 6px white;  }
		div.toolbar audio {	width: 480px; }
		div.repeater { 	max-width: 1000px;	}
	}

	@media only screen and (max-width: 1600px)
	{
		img.player-image[src] { max-width: 360px;   border: solid 4px white;  }
		div.toolbar audio {	width: 300px; }
		div.repeater { 	max-width: 1000px;	}
	}

	@media only screen and (max-width: 1400px)
	{
		div.repeater { 	max-width: 600px;	}
	}

	div.toolbar > * {
		vertical-align: middle;
	}

	a.link-template, a.play-link-template { margin-left: 1em; margin-right: 1em; }

	div.repeater { 	padding-left: 10px; padding-right: 10px; }

	div.playlist-template {
		font-size: 12pt;
		cursor: pointer;
		text-align: left;
		border: 1px solid #CCC;
		padding: 2px;
		margin-left: auto;
		margin-right: auto;
	}

	div.playlist-template div.item-text {
		vertical-align: middle;
		display: inline-block;
	}

	div.playlist-template img[src] {
		height: .7in;
		vertical-align: middle;
	}

	div.tile-template, div.image-template, div.small-image-template {
		display: inline-block;
		vertical-align: top;
		cursor: pointer;
	}

	div.tile-template {
		width: 4in;
		padding: .25in;
	}

	div.image-template {
		width: 40%;
		margin: 20px;
	}

	div.image-template img[src] {
		width: 100%;
		max-width: 900px;
		border: solid 4px white;
	}

	div.tile-template img[src] {
		width: 3in;
		border: solid 4px white;
	}

	div.small-image-template img[src] {
		width: 2in;
		transform: rotate(-5deg);
	}

@media screen {
	.column {
		display: inline-block;
		vertical-align: top;
	}
}
	.column.column-2 {
		width: 48%;
	}

	.column.column-3 {
		width: 30%;
	}

	.column.column-4 {
		width: 24%;
	}

	.pre {
		white-space: pre-line;
	}

	p {
		white-space: pre-line;
		margin-block-start: .5em;
		margin-block-end: 0em;
	}

	a { text-decoration: none; }
	a.logo img { height: 90px; padding-top: 10px; display: inline-block;	}
	.hidden { display: none; }

	@media print {
		.no-print { display: none; }
	}
	</style>
</head>
<body>
<div class="toolbar no-print column">
	<a class="logo"><img /></a><br/>
	<a target="download" class="album-link">DOWNLOAD ALBUM</a>
	<br/><br/>
	<img class="player-image" src="./dmmashups-volume1.jpg"/>
	<br/>
	<br/>
	<button onclick="playPrevious()" title="Previous track"> &lt;&lt; </button>
	<audio id="audioPlayer" controls></audio>
	<button onclick="playNext()" title="Next track"> &gt;&gt; </button>
	<br/>
	<div class="bold player-label"></div>
	<br/>
	<div class="align-left">
		Show:
		<select id="view-mode" onchange="refreshList()">
			<option value="playlist-template">playlist</option>
			<option value="playlist-template.details">playlist with details</option>
			<option value="tile-template">tiles</option>
			<option value="image-template">large images</option>
			<option value="small-image-template">small images</option>
		</select>
		<br/>
		<br/>
		Order:
		<button onclick="shuffle()" title="Shuffle playlist">Shuffle</button>
		<button onclick="reverse()" title="Reverse playlist">Reverse</button>
		<button onclick="reorder()" title="Reset playlist order">Reset</button>
		<br/><br/>
	</div>
</div>

<div class="column">
	<h1><a target="download" class="album-title album-link"></a></h1>
	<h3 id="playlist-links" class="noprint"></h3>

	<div class="repeater"></div>
	<p>All tracks mixed by <a href="https://remix.audio/profile/MinorArth">Minor Arth</a>.</p>
</div>
<div class="links"></div>

<div id="templates" class="hidden">
	<a class="link-template"></a>
	<a class="play-link-template"></a>

	<div class="image-template">
		<img class="artwork"/>
	</div>

	<div class="small-image-template">
		<img class="artwork"/>
	</div>

	<div class="tile-template">
		<img class="artwork"/>
		<p><i class="number"></i>. <b class="title"></b></p>
		<p class="sources"></p>
	</div>

	<div class="playlist-template column">
		<img class="artwork"/>
		<div class="item-text pre"><i class="number"></i>. <b class="title"></b></div>
	</div>

	<div class="playlist-template details column">
		<img class="artwork"/>
		<div class="item-text pre"><i class="number"></i>. <b class="title"></b>
		<p class="sources"></p></div>
	</div>

</div>

<p class="playlist-text hidden" id="DMvolume1" title="DEPECHE MODE mashups volume 1" data-path="">
</p>

<script>
const LOGO_IMAGE = "";
const LOGO_TITLE = "";
const LOGO_LINK = "";

const ALBUM_TITLE = "Some Great Music For The Mashes";
const ALBUM_LINK = "https://www.mediafire.com/file/svuy6z9tx3ucomf/MinorArth-DepecheModeMashups-volume1.zip/file";
const ALBUM_ARTIST = "Minor Arth";
const AUDIO_PATH = "https://remix.audio/uploads/tracks/";
const IMAGE_PATH = "https://remix.audio/uploads/media/";
//const AUDIO_PATH = "";
//const IMAGE_PATH = "./artwork/";
const AUDIO_TYPE = ".mp3";
const IMAGE_TYPE = ".jpg";
var PLAYER_IMAGE = "./dmmashups-volume1.jpg";

const isUrl = s => s && s.includes && s.includes("://");

const audioPlayer = document.querySelector("audio#audioPlayer");
const playlistLinks = document.querySelector("#playlist-links");
const playlists = document.querySelectorAll("p.playlist-text");
var playlist = document.querySelector("p.playlist-text");
var imageList = document.querySelector("p.images");
var trackList = document.querySelector("p.tracks");
const playerImage = document.querySelector(".player-image");
const playerLabel = document.querySelector(".player-label");
const linkContainer = document.querySelector("div.links");
const logoLinks = document.querySelectorAll("a.logo");
const logoImages = document.querySelectorAll(".logo img");
const repeater = document.querySelector("div.repeater");
const albumTitle = document.querySelector(".album-title");
const albumLinks = document.querySelectorAll(".album-link");
const viewMode = document.querySelector("select#view-mode");

var template;
var currentItem = null;
var currentItemElement = null;
var currentItemIndex = null;

var links = {
	"Albums": "..",
	"remix.audio": "https://remix.audio/playlist/2789",
	"YouTube": "https://www.youtube.com/watch?v=FD4xU1Oj8pE&list=PLUq5Z5VhjxM1p4sMIlk6zFlnBRW5hJt1r",
	"Facebook": "https://www.facebook.com/MinorArthMashups",
	"Album cover: @StuffByMark": "https://www.stuffbymark.co.uk"
};

var items = [
	{
		"id": 40384,
		"file": "324915837_547706520_1154582295.mp3",
		"author": "Minor Arth",
		"title": "Everything Lifts Me Up",
		"image": "471523792_571946680_386698616.jpg",
		"sources": [
			"Moby - Lift Me Up | 2005",
			"Depeche Mode - Everything Counts | 1983"
		],
		"songTitle": "Everything Lifts Me Up",
		"artists": "Moby / Depeche Mode"
	},
    {
        "id": 64700,
        "file": "521829124_1884578772_541958666.mp3",
        "author": "Minor Arth",
        "title": "Just Can't Get Temptation",
		"artists": "New Order / Depeche Mode",
		"sources": [
			"New Order - Temptation | 1982",
			"Depeche Mode - Just Can't Get Enough | 1981"
		],
        "image": "1502109165_497738085_506679187.jpg"
    },
	{
		"id": 18107,
		"file": "1211742334_1857274291_1842666095.mp3",
		"author": "Minor Arth",
		"title": "Tears For Fears & Depeche Mode - Never Shout Again",
		"image": "1763003201_1123673197_196675649.jpg", 
		"sources": [
			"Tears For Fears - Never Shout Again | 1985",
			"Depeche Mode - Never Let Me Down Again | 1987",
		],
		"songTitle": "Never Shout Again",
		"artists": "Tears For Fears / Depeche Mode",
		"video": "https://youtu.be/D6RT2ogPu9U"
	},
	{
		"id": 19402,
		"file": "1508467_1802455964_2010175909.mp3",
		"author": "Minor Arth",
		"title": "Strange Model",
		"image": "31169987_570877271_795201279.jpg",
		"artists": "Kraftwerk / Depeche Mode / The Stranglers",
		"sources": [
			"Kraftwerk - The Model | 1978",
			"Depeche Mode - Strangelove | 1987",
			"The Stranglers - The European Female | 1982",
		],
		"video": "https://youtu.be/pz83tO_aTyM"
	},
	{
		"id": 62446,
		"file": "1809322800_633998506_184053351.mp3",
		"author": "Minor Arth",
		"artists": "The Cure / Depeche Mode",
		"title": "Master And Servant Go To Bed",
		"sources": [
			"The Cure - Let's Go To Bed | 1983",
			"Depeche Mode - Master And Servant | 1984"
		],
		"image": "438473383_727208601_1640531236.jpg"
	},
	{
		"id": 51278,
		"file": "1120979652_755243373_1511517317.mp3",
		"author": "Minor Arth",
		"title": "Depeche Mode & Taxi Girl - Photographic Boy | EN | Darc Room mix",
		"image": "568306564_672843720_1722267045.jpg",
		"sources": [
			"Taxi Girl - Cherchez Le Garçon | 1980",
			"Depeche Mode - Photographic | 1981",
		],
		"songTitle": "Photographic Boy",
		"artists": "Taxi Girl / Depeche Mode",
		"video": "https://youtu.be/WXMIItxcu3M"
	},
	{
		"id": 18311,
		"file": "1036391139_1726185446_1785178290.mp3",
		"author": "Minor Arth",
		"title": "Depeche Mode & The Rolling Stones - Gimme Disease",
		"image": "1601254446_1897991313_212754089.jpg",
		"sources": [
			"The Rolling Stones - Gimme Shelter | 1969",
			"Depeche Mode - Shake The Disease | 1985",
			"https://youtu.be/ESx-DHaT7hY"
		],
		"songTitle": "Gimme Disease",
		"artists": "The Rolling Stones / Depeche Mode",
		"video": "https://youtu.be/ESx-DHaT7hY"
	},
    {
        "id": 68423,
        "file": "563353933_1226507571_31415805.mp3",
        "author": "Minor Arth",
        "artists": "Yello / Depeche Mode",
        "title": "Yello & Depeche Mode - Lost Again In Silence",
		"songTitle": "Lost Again In Silence",
		"sources": [
			"Yello - Lost Again | 1983",
			"Depeche Mode - Leave In Silence | 1982"
		],
        "image": "2077564270_856786567_1690330215.jpg"
    },
	{
		"id": 66290,
		"file": "571413028_353465432_238058580.mp3",
		"author": "Minor Arth",
		"artists": "Yeah Yeah Yeahs / Depeche Mode",
		"title": "Depeche Mode & Yeah Yeah Yeahs - The Sun, The Wolf And The Rainfall",
		"songTitle": "The Sun, The Wolf And The Rainfall",
		"sources": [
			"Yeah Yeah Yeahs - Wolf | 2022",
			"Depeche Mode - The Sun And The Rainfall | 1982" 
		],
		"image": "2066350803_1203772279_2020924231.jpg"
	},
	{
		"id": 51708,
		"file": "1043273729_684282083_2008796406.mp3",
		"author": "Minor Arth",
		"title": "Balance Sans Contrefaçon | EN",
		"image": "1917008411_1442662475_374910206.jpg",
		"sources": [
			"Mylène Farmer - Sans Contrefaçon | 1987",
			"Depeche Mode - Get the Balance Right | 1982"
		],
		"songTitle": "Balance Sans Contrefaçon",
		"artists": "Mylène Farmer / Depeche Mode"
	},
	{
		"id": 19401,
		"file": "1992192372_47439495_278507144.mp3",
		"author": "Minor Arth",
		"title": "Kraft Mode - People Are Numbers | Kraftwerk & Depeche Mode",
		"image": "1325777255_834725289_978931676.jpg",
		"sources": [
			"Kraftwerk - Numbers | Computer World | 1981",
			"Depeche Mode - People Are People | 1984",
		],
		"songTitle": "People Are Numbers",
		"artists": "Kraftwerk / Depeche Mode",
		"video": "https://youtu.be/m8zUtJlff_g"
	},
	{
		"id": 53038,
		"file": "1528258040_172576223_2130344446.mp3",
		"author": "Minor Arth",
		"title": "Kavinsky & Depeche Mode - Something To Do In Autodrive",
		"image": "776688174_1168472281_248581402.jpg",
		"sources": [
			"Kavinsky - Testarossa Autodrive | 2007",
			"Depeche Mode - Something To Do | 1984",
			"https://youtu.be/FD4xU1Oj8pE"
		],
		"songTitle": "Something To Do In Autodrive",
		"artists": "Kavinsky / Depeche Mode",
		"video": "https://youtu.be/FD4xU1Oj8pE"
	},
	{
		"id": 59410,
		"file": "459760669_1107128209_1821248495.mp3",
		"author": "Minor Arth",
		"title": "Indochine & Depeche Mode - A Heart At Canary Bay | 80s Mashed vol. 7",
		"image": "1209501321_242983412_110846060.jpg",
		"sources": [
			"Indochine - Canary Bay | 1985",
			"Depeche Mode - It's Called a Heart | 1985"
		],
		"songTitle": "A Heart At Canary Bay",
		"artists": "Indochine / Depeche Mode"
	},
	{
		"id": 65880,
		"file": "771720424_218872985_137092706.mp3",
		"author": "Minor Arth",
		"title": "Berlin & Depeche Mode - Take My Lust Away",
		"artists": "Berlin / Depeche Mode",
		"songTitle": "Take My Lust Away",
		"sources": [
			"Berlin - Take My Breath Away | 1986",
			"Depeche Mode - A Question Of Lust | 1986"
		],
		"image": "450943454_968738645_1625833535.jpg"
	},
	{
		"id": 18124,
		"file": "327004920_1108003792_1817607154.mp3",
		"author": "Minor Arth",
		"title": "Depeche Mode & Curses - Surrender Celebration",
		"image": "538570564_1250100579_1044768237.jpg",
		"sources": [
			"Curses - Surrender | Jennifer Cardini remix | 2019",
			"Depeche Mode - Black Celebration | 1986",
		],
		"songTitle": "Surrender Celebration",
		"artists": "Curses / Depeche Mode",
		"video": "https://youtu.be/AHcUZkA1zsE"
	},
	{
		"id": 34466,
		"file": "880225046_1980996943_302683165.mp3",
		"author": "Minor Arth",
		"title": "Depeche Mode & Chromatics - Love On The Windscreen",
		"image": "1074895215_811649611_1245966278.jpg",
		"sources": [
			"Chromatics - Looking For Love | 2012",
			"Depeche Mode - Love On The Windscreen | 1986"
		],
		"songTitle": "Love On The Windscreen",
		"artists": "Chromatics / Depeche Mode",
		"video": "https://youtu.be/msqqXcLB5jI"
	},
    {
        "id": 63256,
        "file": "306360670_1429166301_10578311.mp3",
        "author": "Minor Arth",
        "title": "Bulletproof Policy Of Truth",
		"artists": "The Silencers / Depeche Mode",
		"sources": [
			"The Silencers - Bulletproof Heart | 1991",
			"Depeche Mode - Policy Of Truth | 1990"
		],
		"video": "https://youtu.be/1ZVwD7-fWd0",
        "image": "321378251_821947349_596519717.jpg"
    },
    {
        "id": 69997,
        "file": "181226506_1463388239_1188404288.mp3",
        "author": "Minor Arth",
        "title": "The Things You Said Today",
		"artists": "The Beatles / Depeche Mode",
		"sources": [
			"The Beatles - Things We Said Today | A Hard Days Night | 1963",
			"Depeche Mode - The Things You Said | Music For The Masses | 1987"
		],
		"video": "https://youtu.be/Nq3D8LNCNm0",
        "image": "893997111_672924943_400995054.jpg"
    },
	{
		"id": 19403,
		"file": "1674492422_1306326625_2003354294.mp3",
		"author": "Minor Arth",
		"title": "Kraft Mode - Halo Robots | Kraftwerk & Depeche Mode",
		"image": "1517760380_736358051_722969622.jpg",
		"sources": [
			"Kraftwerk - The Robots | 1978",
			"Depeche Mode - Halo | 1990"
		],
		"songTitle": "Halo Robots",
		"artists": "Kraftwerk / Depeche Mode",
		"video": "https://youtu.be/pz83tO_aTyM"
	},
	{
		"id": 19836,
		"file": "232555895_1951216380_819161131.mp3",
		"author": "Minor Arth",
		"title": "Depeche Floyd - One Of These Clean Days | Pink Floyd & Depeche Mode",
		"image": "1355645944_1124524783_860623310.jpg",
		"sources": [
			"Pink Floyd - One Of These Days | 1971",
			"Depeche Mode - Clean + Personal Jesus | 1990",
		],
		"songTitle": "One Of These Clean Days",
		"artists": "Pink Floyd / Depeche Mode",
		"video": "https://youtu.be/q5U8O7WZkrM"
	},
	{
		"id": 29114,
		"file": "240896625_1196354146_1178044280.mp3",
		"author": "Minor Arth",
		"title": "Depeche Mode & Sebastien Tellier - Little 15 | Amour & Violence remix",
		"image": "301411327_792073574_746777260.jpg",
		"sources": [
			"Sébastien Tellier - L'Amour et la Violence | 2008",
			"Depeche Mode - Little 15 | 1987"
		],
		"songTitle": "Little 15 | Amour & Violence mix",
		"artists": "Sébastien Tellier / Depeche Mode"
	}
];

// PLAYER_IMAGE = items[0].image;

document.title = ALBUM_TITLE;
albumTitle.innerText = ALBUM_ARTIST ? ALBUM_ARTIST + " - " + ALBUM_TITLE : ALBUM_TITLE;
albumLinks.forEach(a => a.href = ALBUM_LINK);

logoImages.forEach(i => setImage(i, LOGO_IMAGE));
logoLinks.forEach(l => l.href = LOGO_LINK);
displayLinks(linkContainer);

// Audio has ended when this function is executed
audioPlayer.addEventListener('ended', playNext, false);

//window.onresize = () => albumTitle.innerText = innerWidth + " px / ";
//onresize();

if(isUrl(AUDIO_PATH))
{
	setImage(playerImage, PLAYER_IMAGE);
	refreshList();
}
else {
	playlists.forEach(makePlaylistLink);
	setPlaylist(0);
}

function setImage(img, src) {
	if(!img || !src) return;
	return img.src = (isUrl(src) || src.includes("/")) ? src : IMAGE_PATH + src;
}

function setPlaylist(index) {
	if(!index) index = 0;

	if(PLAYER_IMAGE) {
		playerImage.style.display = "inline";
		setImage(playerImage, PLAYER_IMAGE);
		hideBrokenImage(playerImage);
	}

	playlist = playlists[index];
	items = playlist? playlist.innerText.trim().split("\n\n") : [];
	if(items.length == 1) items = playlist.innerText.trim().split("\n");
	items = items.filter(l => l && l.length);
	items = items.map(makePlaylistItem);
	refreshList();
}

function hideBrokenImages() {
	document.querySelectorAll("img.artwork").forEach(hideBrokenImage);
}

function hideBrokenImage(img) {
	img.onerror = () => PLAYER_IMAGE ? img.src = setImage(playerImage, PLAYER_IMAGE) : img.style.display = "none";
}

function shuffle() {
	items.sort(i => Math.random() - .5);
	refreshList();
	return items;
}

function reverse() {
	items.sort(i => -1);
	refreshList();
	return items;
}

function reorder() {
	items.sort( (a,b) => a.n - b.n);
	refreshList();
	return items;
}

function substringBefore(s, sub, last, stringOrEmpty, include, ignoreCase)
{
	if(!s) return s;

	var lstr = s;
	var lsub = sub;
	if(ignoreCase) {
		lstr = lstr.toLowerCase();
		lsub = lsub.toLowerCase();
	}

	var pos = last ? lstr.lastIndexOf(lsub) : lstr.indexOf(lsub);
	if(pos < 0)
		return stringOrEmpty ? "" : s;

	if(include)
		pos += sub.length;
	return s.substring(0, pos);
}

function substringAfter(s, sub, last, stringOrEmpty, include, ignoreCase)
{
	if(!s) return s;

	var lstr = s;
	var lsub = sub;
	if(ignoreCase) {
		lstr = lstr.toLowerCase();
		lsub = lsub.toLowerCase();
	}

	var pos = last ? lstr.lastIndexOf(lsub) : lstr.indexOf(lsub);
	if(pos < 0)
		return stringOrEmpty ? s : "";

	if(!include)
		pos += sub.length;

	return s.substring(pos);
}

function displayLinks(container)
{
	var linkTemplate = document.querySelector("a.link-template");
	if(links)
		for(var key in links) {
			var link = cloneTemplate(linkTemplate, container);
			link.innerText = key;
			link.href = links[key];
			//link.target = "link";
		}
}

function makePlaylistLink(pl, i) {
	if(!pl || !pl.title) return;
	var linkTemplate = document.querySelector("a.play-link-template");
	var link = cloneTemplate(linkTemplate, playlistLinks);
	link.innerText = pl.title;
	link.onclick = () => setPlaylist(i);
}

function refreshList() {
	repeater.innerHTML = "";
	template = document.querySelector("div." + viewMode.value);
	items.forEach(displayPlaylistItem);
}

function makePlaylistItem(item, i) {
	var lines = item.split("\n").filter(l => l && l.length);
	var item = {};
	item.n = i + 1;
	item.title = lines.shift().trim();
	item.image = item.title + ".jpg";
	item.file = item.title + AUDIO_TYPE;
	item.sources = lines;

	var n = Number(substringBefore(item.title, " - "));
	if(n && !isNaN(n)) {
		item.n = n;
		item.title = substringAfter(item.title, " - ");
	}

	var parts = item.title.split(" - ");
	item.songTitle = parts.pop() || "";
	item.songTitle = item.songTitle.replace(" -- ", " | ");
	if(!ALBUM_ARTIST) item.producer = parts.shift();
	item.artists = parts.join(" / ");

	if(!item.artists && item.songTitle.includes("(")) {
		item.artists = substringAfter(item.songTitle, "(", true);
		item.songTitle = item.songTitle.substring(0, par);
		item.artists = substringBefore(item.songTitle, ")", true);
	}

	return item;
}

function displayPlaylistItem(item, i) {
	el = cloneTemplate(template, repeater);
	if(!item.n) item.n = i + 1;
	if(el.querySelector(".number"))
		el.querySelector(".number").innerHTML = item.n;
	el.onclick = () => playFile(i);

	var title = el.querySelector(".title");
	var separator = viewMode.value == "playlist-template0" ? "  -  " : "\n";
	var itemTitle = [ item.artists, item.songTitle || item.title, item.producer ].filter(s => s).join(separator);
	if(title) title.innerHTML = itemTitle;

	var img = el.querySelector("img.artwork");
	if(img && item.image) {
		hideBrokenImage(img);
		img.title = itemTitle;
		setImage(img, item.image);
	}

	if(item.sources)
		item.sources.forEach( (s, j) => isUrl(s) && (item.video = s) );

	if(item.sources && el.querySelector(".sources"))
		item.sources.forEach( (s, j) => el.querySelector(".sources").innerHTML += isUrl(s)? "" : (j ? "\n+ " : "= ") + s );

	if(item.video && title)
		title.innerHTML += '\n<a onclick="stopPropagation(event)" target="video" href="' + item.video + '">VIDEO</a>';

}

function cloneTemplate(node, parent)
{
	var clone = node.cloneNode();
	clone.innerHTML = node.innerHTML;
	if(parent) parent.append(clone);
	return clone;
}

function playFile(item)
{
	if(typeof item == "number") {
		currentItemIndex = item;
		item = items[item];
	}
	if(!item) return;

	currentItem = item;
	playerImage.style.display = "inline";
	setImage(playerImage, item.image);
	playerLabel.innerText = playerImage.title = [item.artists,  item.songTitle || item.title, item.producer].filter(s => s).join("\n");
	var subdir = playlist ? playlist.dataset.path || playlist.getAttribute("path") : "";
	subdir = subdir ? subdir = subdir + "/" : "";
	audioPlayer.src = AUDIO_PATH + subdir + item.file;
	audioPlayer.controls = true;
	audioPlayer.play();

	//highlight current playlist item
	if(currentItemElement)
		currentItemElement.classList.remove("active");
	currentItemElement = repeater.childNodes[currentItemIndex];
	if(currentItemElement)
		currentItemElement.classList.add("active");

	return currentItem;
}

function playNext(evt) {
	console.log("playNext", evt);
	if(currentItemIndex === null) currentItemIndex = -1;
	return playFile(++currentItemIndex % items.length || 0);
}

function playPrevious() {
	if(currentItemIndex === null) currentItemIndex = 0;
	var previousIndex = (--currentItemIndex + items.length) % items.length || 0;
	return playFile(previousIndex);
}

function stopPropagation(event) {
	event.stopPropagation();
}

function m3uPlaylist()
{
	return "#EXTM3U\n" + items.map(i => i.file).join("\n");
}
</script>

</body>
</html>
